<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="http://fonts.cdnfonts.com/css/papyrus" rel="stylesheet">
                
    <title>Chess dev</title>
</head>

<body >
    <style>
        html,body
        {
            padding:0;
            margin:0;
            height:100%;
            width:100%;
            overflow: hidden;
            
            
            -webkit-user-select: none;
            user-select: none;
        }
        html
        {
            background-image: linear-gradient(180deg,#f2b8b8,#DD6240,#3d0a0a);
        }
        *
        {
            overscroll-behavior: none;
        }
        canvas
        {
            border-radius: 20px;
            
        }
        input
        {
            position: absolute;
            width:100px;
            height:70px;
            border-radius: 30px;
            background-color: #f0b1b1;
            border:none;
            filter:drop-shadow(0px 0px 30px black);
            text-align: center;
            font-size: 50px;
            top:20px;
            transition-duration: 0.8s;
            transition-property: left;
            
        }
        label
        {
            position: absolute;
            width:100px;
            height:70px;
            border-radius: 30px;
            border:none;
            filter:drop-shadow(0px 0px 30px rgb(4, 4, 4));
            text-align: center;
            font-size: 50px;
            transition-duration: 0.8s;
            transition-property: color,left;
            font-family: 'Papyrus','Algerian', sans-serif;
                                               
        }
        .draggable
        {
            position:absolute;
            filter: drop-shadow(0px 0px 10px red);
            width: 80px;
            height: 80px;
            transition-property: width,height,left,top,filter,transform;
            transition-duration: 0.8s;
            
            user-select: none;
            -moz-user-select: none;
            -webkit-user-drag: none;
            -webkit-user-select: none;
            -ms-user-select: none;
        }
        #chessBoard
        {
            position:absolute;
            filter:drop-shadow(0px 0px 20px black);
            top:25px;
            transition-duration: 0.8s;
            transition-property: left;
            
        }
    </style>
    <script id="GlobalVariables">
        var turn=false;
        var blackSquares="#191010";
        var whiteSquares="#DD6240";
        var boardOffsetX=(window.innerWidth/window.innerHeight>1)?window.innerWidth/2-320:0;
        const boardOffsetY=25;
        const Pieces=new Array();
        const shadow="red";
        
    </script>
    <script id="GUI">
        
        const switchTurn=function()
        {
            turn=!turn;
            if(turn)
            {
                labelW.style.color="white";
                labelB.style.color="grey";
                for(let i=0;i<Pieces.length;i++)
                {
                    if(!Pieces[i].alive)
                    continue;
                    if(Pieces[i].team!=true)
                    Pieces[i].style.filter=`drop-shadow(0px 0px 10px black)`;
                    else
                    Pieces[i].style.filter=`drop-shadow(0px 0px 10px red)`;
                }
            }
            else
            {
                labelB.style.color="white";
                labelW.style.color="grey";
                for(let i=0;i<Pieces.length;i++)
                {
                    if(!Pieces[i].alive)
                    continue;
                    if(Pieces[i].team==true)
                    Pieces[i].style.filter=`drop-shadow(0px 0px 10px black)`;
                    else
                    Pieces[i].style.filter=`drop-shadow(0px 0px 10px red)`;
                }
            }
        }
        
        const BOARD=new Array(8);
        for(let k=0;k<8;k++)
        {
            BOARD[k]=new Array(8);
            BOARD[k].fill(null);
        }
        
        var addDraggability=function(div)
        {
            var x,y;
            //only for pointer-based devices
            div.onmouseenter=function()
            {
                if(turn!=div.team)
                return;
                div.style.width="85px";
                div.style.height="85px";
                div.style.filter=`drop-shadow(${(div.homeX-320)/32}px ${(div.homeY-320)/32}px 15px ${shadow})`;
            };
            div.onmouseleave=function()
            {
                div.style.width="80px";
                div.style.height="80px";
                div.style.filter=`drop-shadow(0px 0px 10px ${turn==div.team?"red":"black"})`;
            };
            div.drag=function(e)
            {
                div.style.transitionProperty="width,height";
                var xy=getXY(e);
                div.style.left=xy.x-x+"px";
                div.style.top=xy.y-y+"px";
                div.style.filter=`drop-shadow(${(xy.x-320)/32}px ${(xy.y-320)/32}px 15px ${shadow})`;
                
            }
            let md=function(e)
            {
                if(!div.alive)
                return;
                if(turn!=div.team)
                return;
                var xy=getXY(e);
                //div.style.width=100+"px";
                //div.style.height=100+"px";
                div.style.zIndex="2";
                x=Number(xy.x-div.getBoundingClientRect().left);
                y=Number(xy.y-div.getBoundingClientRect().top);
                if(div.alive)
                {
                    document.addEventListener("mousemove",div.drag)
                    document.addEventListener("touchmove",div.drag)
                }
                div.style.width="100px";
                div.style.height="100px";
                //div.style.left=div.homeX+boardOffsetX-10+"px";
                //div.style.top=div.homeY+boardOffsetY-10+"px";
                document.addEventListener("mouseup",docmu)
                document.addEventListener("touchend",docmu)
            };
            div.addEventListener("mousedown",md)
            div.addEventListener("touchstart",md)
            let mu=function(e)
            {
                if(!div.alive)
                return;
                var xy=getXY(e);
                setTimeout(()=>div.style.zIndex="1",1000);
                
                div.style.width=80+"px";
                div.style.height=80+"px";
                div.style.transitionProperty='';
                document.removeEventListener("mousemove",div.drag)
                document.removeEventListener("touchmove",div.drag)
                xy.x-=boardOffsetX;
                xy.y-=boardOffsetY;
                let vx=xy.x-xy.x%80;
                let vy=xy.y-xy.y%80;
                
                if(!(vx>=640 ||  vy>=640  ||  vx<0  ||  vy<0))
                {
                    /**
                     * a successful turn is when:
                     * already is null
                     * or it is of different team
                     */
                    var already=BOARD[vx/80][vy/80];//indexoutofbounds exception never occurs
                    if(already==null)
                    {
                        switchTurn();
                        
                        BOARD[Math.floor(div.homeX/80)][Math.floor(div.homeY/80)]=null;
                        div.homeX=vx;
                        div.homeY=vy;
                        BOARD[Math.floor(div.homeX/80)][Math.floor(div.homeY/80)]=div;
                    }
                    else
                    {
                        if(!(already.team==div.team))
                        {
                            //kill what is already there
                            allotDeadLocation(already);
                            already.alive=false;
                            
                            already.onmouseenter=null;
                            already.onmouseleave=null;
                            switchTurn();
                            already.style.filter=`drop-shadow(0px 0px 10px ${"white"})`;
                            already.style.transform="rotate(180deg)";
                            
                            //repitition
                            BOARD[Math.floor(div.homeX/80)][Math.floor(div.homeY/80)]=null;
                            div.homeX=vx;
                            div.homeY=vy;
                            BOARD[Math.floor(div.homeX/80)][Math.floor(div.homeY/80)]=div;
                        }
                        
                    }
                }
                
                div.style.left=div.homeX+boardOffsetX+"px";
                div.style.top=div.homeY+boardOffsetY+"px";
            };
            let docmu=function(e)
            {
                document.removeEventListener("mousemove",div.drag)
                document.removeEventListener("touchmove",div.drag)
                document.removeEventListener("mouseup",docmu)
                document.removeEventListener("touchend",docmu)
                mu(e);
                
            };
            
        }
        var cx=0;cy=0;
        var face=["br","bn","bb","bq","bk","bb","bn","br","bp","bp","bp","bp","bp","bp","bp","bp",
                    "wp","wp","wp","wp","wp","wp","wp","wp","wr","wn","wb","wk","wq","wb","wn","wr"];
        var board=document.createElement("div");
        var squares=document.createElement("canvas");
        squares.id="chessBoard";
        squares.width=640;
        squares.height=640;
        squares.style.left=window.innerWidth/2-320+"px";
        board.appendChild(squares);
        var g=squares.getContext('2d');
        var painter=function()
        {
            g.clearRect(0,0,squares.width,squares.height);
            let black=false;
            for(let i=0;i<640;i+=80)
            {
                for(let j=0;j<640;j+=80)
                {
                    if(black)
                    {
                        
                        g.fillStyle=blackSquares;
                    }
                    else
                    {
                        g.fillStyle=whiteSquares;
                    }
                    black=!black;
                    g.fillRect(i,j,80,80);
                }
                black=!black;
            }
            //window.requestAnimationFrame(painter);
        }
        window.requestAnimationFrame(painter);
        board.className="#container";
        document.body.appendChild(board);
        for(let i=0;i<face.length;i++)
        {
            var go=document.createElement("img");
            go.id=face[i];
            go.team=go.id.charAt(0)=='b'?false:true;//false means black
            go.className="draggable";
            go.src="Fantasy/"+face[i]+".png";
            board.appendChild(go);
            go.homeX=cx;
            go.homeY=cy;
            go.alive=true;
            go.onclick=(e)=>console.log(e.target);
            BOARD[go.homeX/80][go.homeY/80]=go;
            cx+=80;
            if(cx==640)
            {
                cx=0;
                cy+=80;
            }
            if(cy==160  )
            {
                cy=480;

            }
            go.style.left=go.homeX+boardOffsetX+"px";
            go.style.top=go.homeY+boardOffsetY+"px";
            addDraggability(go);
            Pieces.push(go);
        }
        
        var WColorSelector=document.createElement("input");
        WColorSelector.type="color";
        WColorSelector.style.left=window.innerWidth/2+320+30+"px";
        WColorSelector.value=whiteSquares;
        //document.body.style.backgroundColor=whiteSquares;
        //document.querySelector("html").style.backgroundColor=whiteSquares;
        WColorSelector.innerHTML="Color";
        board.appendChild(WColorSelector);
        var syncW;
        

        var BColorSelector=document.createElement("input");
        BColorSelector.type="color";
        BColorSelector.style.left=window.innerWidth/2+520+30+"px";
        BColorSelector.value=blackSquares;
        
        BColorSelector.innerHTML="Color";
        board.appendChild(BColorSelector);
        var syncB;
        

        var labelW=document.createElement("label");
        labelW.style.left=window.innerWidth/2+320+30+"px";
        labelW.style.top="100px";
        labelW.style.width="300px";
        labelW.innerHTML="White";
        labelW.style.color="white";

        var labelB=document.createElement("label");
        labelB.style.left=window.innerWidth/2-320-330+"px";
        labelB.style.top="100px";
        labelB.style.width="300px";
        labelB.innerHTML="Black";

        labelB.style.backgroundColor=blackSquares;
        labelW.style.backgroundColor=blackSquares;
        
        board.appendChild(labelW);
        board.appendChild(labelB);

        switchTurn();
    </script>
    <script>
        let xb=-330;
        let yb=220;
        let xw=0;
        let yw=220;
        var allotDeadLocation;
        let offsetX=0;
        let offsetY=boardOffsetY;
        console.log("Aspect ratio:",window.innerWidth/window.innerHeight);
        if(window.innerWidth/window.innerHeight>1)
        {
            //landscape view
            WColorSelector.addEventListener("focus", function () 
            {
                syncW=setInterval(function()
                    {
                        whiteSquares=WColorSelector.value;
                        //document.body.style.backgroundColor=whiteSquares;
                        window.requestAnimationFrame(painter);
                    },3);
                
            });
            WColorSelector.addEventListener("blur", function () 
            {
                clearInterval(syncW);
            });
            BColorSelector.addEventListener("focus", function () 
            {
                syncB=setInterval(function()
                    {
                        blackSquares=BColorSelector.value;
                        labelB.style.backgroundColor=blackSquares;
                        labelW.style.backgroundColor=blackSquares;
                        window.requestAnimationFrame(painter);
                    },3);
                
            });
            WColorSelector.addEventListener("blur", function () 
            {
                clearInterval(syncW);
            });
            window.addEventListener("resize",function()
            {
                squares.style.left=window.innerWidth/2-320+"px";
                boardOffsetX=window.innerWidth/2-320;
                WColorSelector.style.left=window.innerWidth/2+320+30+"px";
                BColorSelector.style.left=window.innerWidth/2+520+30+"px";
                labelW.style.left=window.innerWidth/2+320+30+"px";
                labelB.style.left=window.innerWidth/2-320-330+"px";
                labelW.style.textShadow="0px 0px 15px rgb(238, 179, 179)";
                labelB.style.textShadow="0px 0px 15px rgb(238, 179, 179)";
                Pieces.forEach(function(dog)
                {
                    if(dog.alive)
                    dog.style.left=dog.homeX+boardOffsetX+"px";
                    else
                    {
                        if(dog.team==false)
                        dog.style.left=window.innerWidth/2-320+dog.homeX+"px";
                        else
                        dog.style.left=window.innerWidth/2+320+dog.homeX+"px";
                    }
                });
            });
            allotDeadLocation=function(piece)
            {
                if(piece.team==false)
                {
                    
                    piece.style.left=window.innerWidth/2-320+xb+"px";
                    piece.style.top=yb+"px";
                    piece.style.height="75px";
                    piece.style.width="75px";
                    piece.homeX=xb;
                    piece.homeY=yb;
                    xb+=75;
                    if(xb==-30)
                    {
                        xb=-330;
                        yb+=75;
                    }
                    
                }
                else
                {
                    piece.style.left=window.innerWidth/2+330+xw+"px";
                    piece.style.top=yw+"px";
                    piece.style.height="75px";
                    piece.style.width="75px";
                    piece.homeX=xw;
                    piece.homeY=yw;
                    xw+=75;
                    if(xw==300)
                    {
                        xw=0;
                        yw+=75;
                    }
                }
                
                
            };

        }
        else
        {
            //portrait view
            squares.style.left="0px";
            Pieces.forEach(function(dog)
                {
                    if(dog.alive)
                    dog.style.left=dog.homeX+boardOffsetX+"px";
                    else
                    {
                        if(dog.team==false)
                        dog.style.left=window.innerWidth/2-320+dog.homeX+"px";
                        else
                        dog.style.left=window.innerWidth/2+320+dog.homeX+"px";
                    }
                });
                boardOffsetX=0;
                WColorSelector.style.left="520px";
                BColorSelector.style.left="20px";
                WColorSelector.style.top="760px";
                BColorSelector.style.top="760px";
                labelW.style.left="320px";
                labelB.style.left="20px";
                labelW.style.top="680px";
                labelB.style.top="680px";

                xb=0;
                xw=320;
                yb=840;
                yw=840;
                allotDeadLocation=function(piece)
                {
                    if(piece.team==false)
                    {
                        
                        piece.style.left=xb+"px";
                        piece.style.top=yb+"px";
                        piece.style.height="75px";
                        piece.style.width="75px";
                        piece.homeX=xb;
                        piece.homeY=yb;
                        xb+=60;
                        if(xb==240)
                        {
                            xb=0;
                            yb+=60;
                        }
                        
                    }
                    else
                    {
                        piece.style.left=xw+"px";
                        piece.style.top=yw+"px";
                        piece.style.height="75px";
                        piece.style.width="75px";
                        piece.homeX=xw;
                        piece.homeY=yw;
                        xw+=60;
                        
                        if(xw==320+240)
                        {
                            xw=320;
                            yw+=60;
                        }
                    }
                    
                    
                }
        }

        function getXY(e)
        {
            if(e.type.substring(0,5)=="touch")
            {
                let evt=(typeof e.originalEvent==='undefined')?e:e.originalEvent;
                let touch=evt.touches[0]||evt.changedTouches[0];
                return {"x":touch.pageX,"y":touch.pageY};
            }
            else if(e.type.substring(0,5)=="mouse")
            {
                return {"x":e.clientX,"y":e.clientY};
            }
        }
        let play=0;
        let playstart=function()
        {
            clearInterval(play);
            play=setInterval(function()
            {
                let temp=Pieces[Math.floor(Math.random()*Pieces.length)].style;
                temp.left=Math.floor(Math.random()*560/80)*80+boardOffsetX+"px";
                temp.top=Math.floor(Math.random()*560/80)*80+boardOffsetY+"px";
            },50);
        }
        let playend=function()
        {
            clearInterval(play);
            for(let i=0;i<Pieces.length;i++)
            {
                Pieces[i].style.top=Pieces[i].homeY+boardOffsetY+"px";
                Pieces[i].style.left=Pieces[i].homeX+boardOffsetX+"px";
            }
            window.dispatchEvent(new Event('resize'));
        }
        labelB.addEventListener("touchstart",playstart);
        labelB.addEventListener("click",playstart);
        labelW.addEventListener("touchstart",playend);
        labelW.addEventListener("click",playend);
    </script>
</body>
</html>
